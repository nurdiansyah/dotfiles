#!/bin/sh
# Prevent committing symlinks into the repo root (or anywhere)
# Exits non-zero if any staged path is a symlink

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
if [ -z "$STAGED_FILES" ]; then
  exit 0
fi

has_symlink=0
for f in $STAGED_FILES; do
  if [ -L "$f" ]; then
    echo "Error: attempting to commit symlink: $f" >&2
    has_symlink=1
  fi
done

if [ "$has_symlink" -eq 1 ]; then
  echo "Commit aborted: remove symlink(s) or use a normal file instead." >&2
  exit 1
fi

exit 0
